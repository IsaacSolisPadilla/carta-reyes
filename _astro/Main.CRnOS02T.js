import{e as Cs,c as mt,l as zr,u as Kt,a as C,b as Jr,h as ae,d as Gr,E as Vr,r as Yr,H as Qr,s as Ht,f as bt,g as rt,i as nr,j as lt,k as Xr,U as xs,m as Zr,n as ir,p as es,o as Je,q as ts,t as Is,v as m,w as rs,C as $s,x as Us,y as At,z as Rt,A as hr,B as pe,D as dr,F as ss,G as Ns,I as Ls,J as It,K as ns,L as is,M as Ds,N as Bs,O as qs,P as Ms,Q as Fs,R as ar,S as Ws,T as Ks,V as Hs,W as zs,X as Js,Y as Gs,Z as Vs,_ as Ys,$ as Qs,a0 as as,a1 as Xs,a2 as et,a3 as Zs,a4 as fr,a5 as en,a6 as L,a7 as tn,a8 as rn,a9 as sn,aa as nn,ab as an,ac as X,ad as on,ae as ln,af as cn,ag as un,ah as hn,ai as dn,aj as D,ak as M,al as Ye,am as U,an as Pt,ao as jt,ap as I,aq as N,ar as J,as as ee,at as je,au as yt,av as fn,aw as gn}from"./render.Bhkc3Y96.js";const pn="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(pn);Cs();function vn(n){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function os(n){mt===null&&vn(),zr&&mt.l!==null?_n(mt).m.push(n):Kt(()=>{const e=C(n);if(typeof e=="function")return e})}function _n(n){var e=n.l;return e.u??={a:[],b:[],m:[]}}function Q(n,e,t=!1){ae&&Gr();var r=n,s=null,i=null,a=xs,o=t?Vr:0,c=!1;const l=(g,f=!0)=>{c=!0,d(f,g)};var u=null;function h(){u!==null&&(u.lastChild.remove(),r.before(u),u=null);var g=a?s:i,f=a?i:s;g&&ir(g),f&&es(f,()=>{a?i=null:s=null})}const d=(g,f)=>{if(a===(a=g))return;let p=!1;if(ae){const A=Yr(r)===Qr;!!a===A&&(r=Ht(),bt(r),rt(!1),p=!0)}var v=Zr(),y=r;if(v&&(u=document.createDocumentFragment(),u.append(y=nr())),a?s??=f&&lt(()=>f(y)):i??=f&&lt(()=>f(y)),v){var _=Xr,w=a?s:i,E=a?i:s;w&&_.skipped_effects.delete(w),E&&_.skipped_effects.add(E),_.add_callback(h)}else h();p&&rt(!0)};Jr(()=>{c=!1,e(l),c||d(null,null)},o),ae&&(r=Je)}function Et(n,e){return e}function wn(n,e,t){for(var r=n.items,s=[],i=e.length,a=0;a<i;a++)qs(e[a].e,s,!0);var o=i>0&&s.length===0&&t!==null;if(o){var c=t.parentNode;Ms(c),c.append(t),r.clear(),fe(n,e[0].prev,e[i-1].next)}Fs(s,()=>{for(var l=0;l<i;l++){var u=e[l];o||(r.delete(u.k),fe(n,u.prev,u.next)),is(u.e,!o)}})}function st(n,e,t,r,s,i=null){var a=n,o={flags:e,items:new Map,first:null},c=(e&ts)!==0;if(c){var l=n;a=ae?bt(Is(l)):l.appendChild(nr())}ae&&Gr();var u=null,h=!1,d=new Map,g=rs(()=>{var y=t();return Ns(y)?y:y==null?[]:ss(y)}),f,p;function v(){mn(p,f,o,d,a,s,e,r,t),i!==null&&(f.length===0?u?ir(u):u=lt(()=>i(a)):u!==null&&es(u,()=>{u=null}))}Jr(()=>{p??=ar,f=m(g);var y=f.length;if(h&&y===0)return;h=y===0;let _=!1;if(ae){var w=Yr(a)===Qr;w!==(y===0)&&(a=Ht(),bt(a),rt(!1),_=!0)}if(ae){for(var E=null,A,b=0;b<y;b++){if(Je.nodeType===$s&&Je.data===Us){a=Je,_=!0,rt(!1);break}var S=f[b],x=r(S,b);A=zt(Je,o,E,null,S,x,b,s,e,t),o.items.set(x,A),E=A}y>0&&bt(Ht())}if(ae)y===0&&i&&(u=lt(()=>i(a)));else if(Zr()){var H=new Set,ve=Xr;for(b=0;b<y;b+=1){S=f[b],x=r(S,b);var O=o.items.get(x)??d.get(x);O?(e&(At|Rt))!==0&&ls(O,S,b,e):(A=zt(null,o,null,null,S,x,b,s,e,t,!0),d.set(x,A)),H.add(x)}for(const[P,$]of o.items)H.has(P)||ve.skipped_effects.add($.e);ve.add_callback(v)}else v();_&&rt(!0),m(g)}),ae&&(a=Je)}function mn(n,e,t,r,s,i,a,o,c){var l=(a&Ds)!==0,u=(a&(At|Rt))!==0,h=e.length,d=t.items,g=t.first,f=g,p,v=null,y,_=[],w=[],E,A,b,S;if(l)for(S=0;S<h;S+=1)E=e[S],A=o(E,S),b=d.get(A),b!==void 0&&(b.a?.measure(),(y??=new Set).add(b));for(S=0;S<h;S+=1){if(E=e[S],A=o(E,S),b=d.get(A),b===void 0){var x=r.get(A);if(x!==void 0){r.delete(A),d.set(A,x);var H=v?v.next:f;fe(t,v,x),fe(t,x,H),$t(x,H,s),v=x}else{var ve=f?f.e.nodes_start:s;v=zt(ve,t,v,v===null?t.first:v.next,E,A,S,i,a,c)}d.set(A,v),_=[],w=[],f=v.next;continue}if(u&&ls(b,E,S,a),(b.e.f&It)!==0&&(ir(b.e),l&&(b.a?.unfix(),(y??=new Set).delete(b))),b!==f){if(p!==void 0&&p.has(b)){if(_.length<w.length){var O=w[0],P;v=O.prev;var $=_[0],G=_[_.length-1];for(P=0;P<_.length;P+=1)$t(_[P],O,s);for(P=0;P<w.length;P+=1)p.delete(w[P]);fe(t,$.prev,G.next),fe(t,v,$),fe(t,G,O),f=O,v=G,S-=1,_=[],w=[]}else p.delete(b),$t(b,f,s),fe(t,b.prev,b.next),fe(t,b,v===null?t.first:v.next),fe(t,v,b),v=b;continue}for(_=[],w=[];f!==null&&f.k!==A;)(f.e.f&It)===0&&(p??=new Set).add(f),w.push(f),f=f.next;if(f===null)continue;b=f}_.push(b),v=b,f=b.next}if(f!==null||p!==void 0){for(var re=p===void 0?[]:ss(p);f!==null;)(f.e.f&It)===0&&re.push(f),f=f.next;var Z=re.length;if(Z>0){var te=(a&ts)!==0&&h===0?s:null;if(l){for(S=0;S<Z;S+=1)re[S].a?.measure();for(S=0;S<Z;S+=1)re[S].a?.fix()}wn(t,re,te)}}l&&ns(()=>{if(y!==void 0)for(b of y)b.a?.apply()}),n.first=t.first&&t.first.e,n.last=v&&v.e;for(var q of r.values())is(q.e);r.clear()}function ls(n,e,t,r){(r&At)!==0&&hr(n.v,e),(r&Rt)!==0?hr(n.i,t):n.i=t}function zt(n,e,t,r,s,i,a,o,c,l,u){var h=(c&At)!==0,d=(c&Ls)===0,g=h?d?pe(s,!1,!1):dr(s):s,f=(c&Rt)===0?a:dr(a),p={i:f,v:g,k:i,a:null,e:null,prev:t,next:r};try{if(n===null){var v=document.createDocumentFragment();v.append(n=nr())}return p.e=lt(()=>o(n,g,f,l),ae),p.e.prev=t&&t.e,p.e.next=r&&r.e,t===null?u||(e.first=p):(t.next=p,t.e.next=p.e),r!==null&&(r.prev=p,r.e.prev=p.e),p}finally{}}function $t(n,e,t){for(var r=n.next?n.next.e.nodes_start:t,s=e?e.e.nodes_start:t,i=n.e.nodes_start;i!==null&&i!==r;){var a=Bs(i);s.before(i),i=a}}function fe(n,e,t){e===null?n.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}const gr=[...` 	
\r\fÂ \v\uFEFF`];function bn(n,e,t){var r=n==null?"":""+n;if(e&&(r=r?r+" "+e:e),t){for(var s in t)if(t[s])r=r?r+" "+s:s;else if(r.length)for(var i=s.length,a=0;(a=r.indexOf(s,a))>=0;){var o=a+i;(a===0||gr.includes(r[a-1]))&&(o===r.length||gr.includes(r[o]))?r=(a===0?"":r.substring(0,a))+r.substring(o+1):a=o}}return r===""?null:r}function nt(n,e,t,r,s,i){var a=n.__className;if(ae||a!==t||a===void 0){var o=bn(t,r,i);(!ae||o!==n.getAttribute("class"))&&(o==null?n.removeAttribute("class"):n.className=o),n.__className=t}else if(i&&s!==i)for(var c in i){var l=!!i[c];(s==null||l!==!!s[c])&&n.classList.toggle(c,l)}return i}const yn=Symbol("is custom element"),En=Symbol("is html");function de(n,e,t,r){var s=Sn(n);ae&&(s[e]=n.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&n.nodeName==="LINK")||s[e]!==(s[e]=t)&&(e==="loading"&&(n[Ws]=t),t==null?n.removeAttribute(e):typeof t!="string"&&kn(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function Sn(n){return n.__attributes??={[yn]:n.nodeName.includes("-"),[En]:n.namespaceURI===Ks}}var pr=new Map;function kn(n){var e=n.getAttribute("is")||n.nodeName,t=pr.get(e);if(t)return t;pr.set(e,t=[]);for(var r,s=n,i=Element.prototype;i!==s;){r=zs(s);for(var a in r)r[a].set&&t.push(a);s=Hs(s)}return t}const Tn=()=>performance.now(),me={tick:n=>requestAnimationFrame(n),now:()=>Tn(),tasks:new Set};function cs(){const n=me.now();me.tasks.forEach(e=>{e.c(n)||(me.tasks.delete(e),e.f())}),me.tasks.size!==0&&me.tick(cs)}function On(n){let e;return me.tasks.size===0&&me.tick(cs),{promise:new Promise(t=>{me.tasks.add(e={c:n,f:t})}),abort(){me.tasks.delete(e)}}}function vr(n,e){as(()=>{n.dispatchEvent(new CustomEvent(e))})}function An(n){if(n==="float")return"cssFloat";if(n==="offset")return"cssOffset";if(n.startsWith("--"))return n;const e=n.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function _r(n){const e={},t=n.split(";");for(const r of t){const[s,i]=r.split(":");if(!s||i===void 0)break;const a=An(s.trim());e[a]=i.trim()}return e}const Rn=n=>n;function Pn(n,e,t,r){var s=(n&Qs)!==0,i="in",a,o=e.inert,c=e.style.overflow,l,u;function h(){return as(()=>a??=t()(e,r?.()??{},{direction:i}))}var d={is_global:s,in(){e.inert=o,l?.abort(),vr(e,"introstart"),l=us(e,h(),u,1,()=>{vr(e,"introend"),l?.abort(),l=a=void 0,e.style.overflow=c})},out(v){{v?.(),a=void 0;return}},stop:()=>{l?.abort()}},g=ar;if((g.transitions??=[]).push(d),Js){var f=s;if(!f){for(var p=g.parent;p&&(p.f&Vr)!==0;)for(;(p=p.parent)&&(p.f&Gs)===0;);f=!p||(p.f&Vs)!==0}f&&Ys(()=>{C(()=>d.in())})}}function us(n,e,t,r,s){if(Xs(e)){var i,a=!1;return ns(()=>{if(!a){var p=e({direction:"in"});i=us(n,p,t,r,s)}}),{abort:()=>{a=!0,i?.abort()},deactivate:()=>i.deactivate(),reset:()=>i.reset(),t:()=>i.t()}}if(!e?.duration)return s(),{abort:et,deactivate:et,reset:et,t:()=>r};const{delay:o=0,css:c,tick:l,easing:u=Rn}=e;var h=[];if(l&&l(0,1),c){var d=_r(c(0,1));h.push(d,d)}var g=()=>1-r,f=n.animate(h,{duration:o,fill:"forwards"});return f.onfinish=()=>{f.cancel();var p=1-r,v=r-p,y=e.duration*Math.abs(v),_=[];if(y>0){var w=!1;if(c)for(var E=Math.ceil(y/16.666666666666668),A=0;A<=E;A+=1){var b=p+v*u(A/E),S=_r(c(b,1-b));_.push(S),w||=S.overflow==="hidden"}w&&(n.style.overflow="hidden"),g=()=>{var x=f.currentTime;return p+v*u(x/y)},l&&On(()=>{if(f.playState!=="running")return!1;var x=g();return l(x,1-x),!0})}f=n.animate(_,{duration:y,fill:"forwards"}),f.onfinish=()=>{g=()=>r,l?.(r,1-r),s()}},{abort:()=>{f&&(f.cancel(),f.effect=null,f.onfinish=et)},deactivate:()=>{s=et},reset:()=>{},t:()=>g()}}function Ct(n=!1){const e=mt,t=e.l.u;if(!t)return;let r=()=>L(e.s);if(n){let s=0,i={};const a=tn(()=>{let o=!1;const c=e.s;for(const l in c)c[l]!==i[l]&&(i[l]=c[l],o=!0);return o&&s++,s});r=()=>m(a)}t.b.length&&Zs(()=>{wr(e,r),fr(t.b)}),Kt(()=>{const s=C(()=>t.m.map(en));return()=>{for(const i of s)typeof i=="function"&&i()}}),t.a.length&&Kt(()=>{wr(e,r),fr(t.a)})}function wr(n,e){if(n.l.s)for(const t of n.l.s)m(t);e()}let gt=!1;function jn(n){var e=gt;try{return gt=!1,[n(),gt]}finally{gt=e}}function Ce(n,e,t,r){var s=!zr||(t&ln)!==0,i=(t&cn)!==0,a=r,o=!0,c=()=>(o&&(o=!1,a=r),a),l;{var u=hn in n||dn in n;l=rn(n,e)?.set??(u&&e in n?_=>n[e]=_:void 0)}var h,d=!1;[h,d]=jn(()=>n[e]),h===void 0&&r!==void 0&&(h=c(),l&&(s&&sn(),l(h)));var g;if(s?g=()=>{var _=n[e];return _===void 0?c():(o=!0,_)}:g=()=>{var _=n[e];return _!==void 0&&(a=void 0),_===void 0?a:_},s&&(t&nn)===0)return g;if(l){var f=n.$$legacy;return(function(_,w){return arguments.length>0?((!s||!w||f||d)&&l(w?g():_),_):g()})}var p=!1,v=rs(()=>(p=!1,g()));m(v);var y=ar;return(function(_,w){if(arguments.length>0){const E=w?m(v):s&&i?an(_):_;return X(v,E),p=!0,a!==void 0&&(a=E),_}return un&&p||(y.f&on)!==0?v.v:m(v)})}var Cn=D("<img/>"),xn=D(`<button type="button" role="tab" class="shrink-0 px-3 py-2 rounded-2xl border bg-white/80
                   flex items-center gap-2 transition-all
                   hover:shadow-sm hover:-translate-y-0.5
                   data-[active=true]:bg-gradient-to-r data-[active=true]:from-amber-100 data-[active=true]:to-pink-100
                   data-[active=true]:border-amber-300 data-[active=true]:shadow"><!> <span class="text-sm font-medium"> </span></button>`),In=D('<div class="mb-2 text-sm font-medium opacity-80">Â¿QuiÃ©n eres?</div> <div class="flex gap-2 overflow-x-auto pb-2" role="tablist" aria-label="Selector de perfil"></div>',1);function $n(n,e){jt(e,!1);let t=Ce(e,"current",8,null),r=Ce(e,"onPick",8),s=pe([]);os(()=>{X(s,"Conchi:/avatar-conchi.png;Ainara:/avatar-hermana.png;Celia del Carmen:/avatar-pareja.png".split(";").filter(Boolean).map(c=>{const[l]=c.split(":");return{name:l}}))}),Ct();var i=In(),a=M(Ye(i),2);st(a,5,()=>m(s),Et,(o,c)=>{var l=xn(),u=N(l);{var h=f=>{var p=Cn();let v;J(y=>{de(p,"src",(m(c),C(()=>m(c).avatar))),de(p,"alt",(m(c),C(()=>m(c).name))),v=nt(p,1,"w-7 h-7 rounded-full ring-2",null,v,y)},[()=>({"ring-amber-300":t()===m(c).name,"ring-transparent":t()!==m(c).name})]),U(f,p)};Q(u,f=>{m(c),C(()=>m(c).avatar)&&f(h)})}var d=M(u,2),g=N(d,!0);I(d),I(l),J(()=>{de(l,"aria-selected",(L(t()),m(c),C(()=>t()===m(c).name))),de(l,"data-active",(L(t()),m(c),C(()=>t()===m(c).name))),ee(g,(m(c),C(()=>m(c).name)))}),je("click",l,()=>r()(m(c).name)),U(o,l)}),I(a),U(n,i),Pt()}const Un="modulepreload",Nn=function(n){return"/carta-reyes/"+n},mr={},ht=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){let a=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=o?.nonce||o?.getAttribute("nonce");s=a(t.map(l=>{if(l=Nn(l),l in mr)return;mr[l]=!0;const u=l.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":Un,u||(d.as="script"),d.crossOrigin="",d.href=l,c&&d.setAttribute("nonce",c),document.head.appendChild(d),u)return new Promise((g,f)=>{d.addEventListener("load",g),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return s.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})},Ln=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>ht(async()=>{const{default:r}=await Promise.resolve().then(()=>Ze);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class or extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class br extends or{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class yr extends or{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Er extends or{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Jt;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(Jt||(Jt={}));var Dn=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};class Bn{constructor(e,{headers:t={},customFetch:r,region:s=Jt.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=Ln(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Dn(this,arguments,void 0,function*(t,r={}){var s;try{const{headers:i,method:a,body:o,signal:c}=r;let l={},{region:u}=r;u||(u=this.region);const h=new URL(`${this.url}/${t}`);u&&u!=="any"&&(l["x-region"]=u,h.searchParams.set("forceFunctionRegion",u));let d;o&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",d=o):typeof o=="string"?(l["Content-Type"]="text/plain",d=o):typeof FormData<"u"&&o instanceof FormData?d=o:(l["Content-Type"]="application/json",d=JSON.stringify(o)));const g=yield this.fetch(h.toString(),{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),i),body:d,signal:c}).catch(y=>{throw y.name==="AbortError"?y:new br(y)}),f=g.headers.get("x-relay-error");if(f&&f==="true")throw new yr(g);if(!g.ok)throw new Er(g);let p=((s=g.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),v;return p==="application/json"?v=yield g.json():p==="application/octet-stream"?v=yield g.blob():p==="text/event-stream"?v=g:p==="multipart/form-data"?v=yield g.formData():v=yield g.text(),{data:v,error:null,response:g}}catch(i){return i instanceof Error&&i.name==="AbortError"?{data:null,error:new br(i)}:{data:null,error:i,response:i instanceof Er||i instanceof yr?i.context:void 0}}})}}function qn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Mn(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var V={},Ne={},Le={},De={},Be={},qe={},Fn=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Xe=Fn();const Wn=Xe.fetch,hs=Xe.fetch.bind(Xe),ds=Xe.Headers,Kn=Xe.Request,Hn=Xe.Response,Ze=Object.freeze(Object.defineProperty({__proto__:null,Headers:ds,Request:Kn,Response:Hn,default:hs,fetch:Wn},Symbol.toStringTag,{value:"Module"})),zn=Mn(Ze);var pt={},Sr;function fs(){if(Sr)return pt;Sr=1,Object.defineProperty(pt,"__esModule",{value:!0});class n extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return pt.default=n,pt}var kr;function gs(){if(kr)return qe;kr=1;var n=qe&&qe.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(qe,"__esModule",{value:!0});const e=n(zn),t=n(fs());class r{constructor(i){var a,o;this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=new Headers(i.headers),this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=(a=i.shouldThrowOnError)!==null&&a!==void 0?a:!1,this.signal=i.signal,this.isMaybeSingle=(o=i.isMaybeSingle)!==null&&o!==void 0?o:!1,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,a){return this.headers=new Headers(this.headers),this.headers.set(i,a),this}then(i,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const o=this.fetch;let c=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var u,h,d,g;let f=null,p=null,v=null,y=l.status,_=l.statusText;if(l.ok){if(this.method!=="HEAD"){const b=await l.text();b===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((u=this.headers.get("Accept"))===null||u===void 0)&&u.includes("application/vnd.pgrst.plan+text"))?p=b:p=JSON.parse(b))}const E=(h=this.headers.get("Prefer"))===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),A=(d=l.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");E&&A&&A.length>1&&(v=parseInt(A[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(p)&&(p.length>1?(f={code:"PGRST116",details:`Results contain ${p.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},p=null,v=null,y=406,_="Not Acceptable"):p.length===1?p=p[0]:p=null)}else{const E=await l.text();try{f=JSON.parse(E),Array.isArray(f)&&l.status===404&&(p=[],f=null,y=200,_="OK")}catch{l.status===404&&E===""?(y=204,_="No Content"):f={message:E}}if(f&&this.isMaybeSingle&&(!((g=f?.details)===null||g===void 0)&&g.includes("0 rows"))&&(f=null,y=200,_="OK"),f&&this.shouldThrowOnError)throw new t.default(f)}return{error:f,data:p,count:v,status:y,statusText:_}});return this.shouldThrowOnError||(c=c.catch(l=>{var u,h,d;return{error:{message:`${(u=l?.name)!==null&&u!==void 0?u:"FetchError"}: ${l?.message}`,details:`${(h=l?.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(d=l?.code)!==null&&d!==void 0?d:""}`},data:null,count:null,status:0,statusText:""}})),c.then(i,a)}returns(){return this}overrideTypes(){return this}}return qe.default=r,qe}var Tr;function ps(){if(Tr)return Be;Tr=1;var n=Be&&Be.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Be,"__esModule",{value:!0});const e=n(gs());class t extends e.default{select(s){let i=!1;const a=(s??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:i=!0,nullsFirst:a,foreignTable:o,referencedTable:c=o}={}){const l=c?`${c}.order`:"order",u=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${u?`${u},`:""}${s}.${i?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:i,referencedTable:a=i}={}){const o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${s}`),this}range(s,i,{foreignTable:a,referencedTable:o=a}={}){const c=typeof o>"u"?"offset":`${o}.offset`,l=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(c,`${s}`),this.url.searchParams.set(l,`${i-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:i=!1,settings:a=!1,buffers:o=!1,wal:c=!1,format:l="text"}={}){var u;const h=[s?"analyze":null,i?"verbose":null,a?"settings":null,o?"buffers":null,c?"wal":null].filter(Boolean).join("|"),d=(u=this.headers.get("Accept"))!==null&&u!==void 0?u:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${l}; for="${d}"; options=${h};`),l==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return Be.default=t,Be}var Or;function lr(){if(Or)return De;Or=1;var n=De&&De.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(De,"__esModule",{value:!0});const e=n(ps());class t extends e.default{eq(s,i){return this.url.searchParams.append(s,`eq.${i}`),this}neq(s,i){return this.url.searchParams.append(s,`neq.${i}`),this}gt(s,i){return this.url.searchParams.append(s,`gt.${i}`),this}gte(s,i){return this.url.searchParams.append(s,`gte.${i}`),this}lt(s,i){return this.url.searchParams.append(s,`lt.${i}`),this}lte(s,i){return this.url.searchParams.append(s,`lte.${i}`),this}like(s,i){return this.url.searchParams.append(s,`like.${i}`),this}likeAllOf(s,i){return this.url.searchParams.append(s,`like(all).{${i.join(",")}}`),this}likeAnyOf(s,i){return this.url.searchParams.append(s,`like(any).{${i.join(",")}}`),this}ilike(s,i){return this.url.searchParams.append(s,`ilike.${i}`),this}ilikeAllOf(s,i){return this.url.searchParams.append(s,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(s,i){return this.url.searchParams.append(s,`ilike(any).{${i.join(",")}}`),this}is(s,i){return this.url.searchParams.append(s,`is.${i}`),this}in(s,i){const a=Array.from(new Set(i)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(s,`in.(${a})`),this}contains(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cs.{${i.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(i)}`),this}containedBy(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cd.{${i.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(i)}`),this}rangeGt(s,i){return this.url.searchParams.append(s,`sr.${i}`),this}rangeGte(s,i){return this.url.searchParams.append(s,`nxl.${i}`),this}rangeLt(s,i){return this.url.searchParams.append(s,`sl.${i}`),this}rangeLte(s,i){return this.url.searchParams.append(s,`nxr.${i}`),this}rangeAdjacent(s,i){return this.url.searchParams.append(s,`adj.${i}`),this}overlaps(s,i){return typeof i=="string"?this.url.searchParams.append(s,`ov.${i}`):this.url.searchParams.append(s,`ov.{${i.join(",")}}`),this}textSearch(s,i,{config:a,type:o}={}){let c="";o==="plain"?c="pl":o==="phrase"?c="ph":o==="websearch"&&(c="w");const l=a===void 0?"":`(${a})`;return this.url.searchParams.append(s,`${c}fts${l}.${i}`),this}match(s){return Object.entries(s).forEach(([i,a])=>{this.url.searchParams.append(i,`eq.${a}`)}),this}not(s,i,a){return this.url.searchParams.append(s,`not.${i}.${a}`),this}or(s,{foreignTable:i,referencedTable:a=i}={}){const o=a?`${a}.or`:"or";return this.url.searchParams.append(o,`(${s})`),this}filter(s,i,a){return this.url.searchParams.append(s,`${i}.${a}`),this}}return De.default=t,De}var Ar;function vs(){if(Ar)return Le;Ar=1;var n=Le&&Le.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Le,"__esModule",{value:!0});const e=n(lr());class t{constructor(s,{headers:i={},schema:a,fetch:o}){this.url=s,this.headers=new Headers(i),this.schema=a,this.fetch=o}select(s,i){const{head:a=!1,count:o}=i??{},c=a?"HEAD":"GET";let l=!1;const u=(s??"*").split("").map(h=>/\s/.test(h)&&!l?"":(h==='"'&&(l=!l),h)).join("");return this.url.searchParams.set("select",u),o&&this.headers.append("Prefer",`count=${o}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:i,defaultToNull:a=!0}={}){var o;const c="POST";if(i&&this.headers.append("Prefer",`count=${i}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const l=s.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(l.length>0){const u=[...new Set(l)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}upsert(s,{onConflict:i,ignoreDuplicates:a=!1,count:o,defaultToNull:c=!0}={}){var l;const u="POST";if(this.headers.append("Prefer",`resolution=${a?"ignore":"merge"}-duplicates`),i!==void 0&&this.url.searchParams.set("on_conflict",i),o&&this.headers.append("Prefer",`count=${o}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const h=s.reduce((d,g)=>d.concat(Object.keys(g)),[]);if(h.length>0){const d=[...new Set(h)].map(g=>`"${g}"`);this.url.searchParams.set("columns",d.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}update(s,{count:i}={}){var a;const o="PATCH";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}delete({count:s}={}){var i;const a="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}}return Le.default=t,Le}var Rr;function Jn(){if(Rr)return Ne;Rr=1;var n=Ne&&Ne.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ne,"__esModule",{value:!0});const e=n(vs()),t=n(lr());class r{constructor(i,{headers:a={},schema:o,fetch:c}={}){this.url=i,this.headers=new Headers(a),this.schemaName=o,this.fetch=c}from(i){const a=new URL(`${this.url}/${i}`);return new e.default(a,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new r(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,a={},{head:o=!1,get:c=!1,count:l}={}){var u;let h;const d=new URL(`${this.url}/rpc/${i}`);let g;o||c?(h=o?"HEAD":"GET",Object.entries(a).filter(([p,v])=>v!==void 0).map(([p,v])=>[p,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([p,v])=>{d.searchParams.append(p,v)})):(h="POST",g=a);const f=new Headers(this.headers);return l&&f.set("Prefer",`count=${l}`),new t.default({method:h,url:d,headers:f,schema:this.schemaName,body:g,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}}return Ne.default=r,Ne}var Pr;function Gn(){if(Pr)return V;Pr=1;var n=V&&V.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(V,"__esModule",{value:!0}),V.PostgrestError=V.PostgrestBuilder=V.PostgrestTransformBuilder=V.PostgrestFilterBuilder=V.PostgrestQueryBuilder=V.PostgrestClient=void 0;const e=n(Jn());V.PostgrestClient=e.default;const t=n(vs());V.PostgrestQueryBuilder=t.default;const r=n(lr());V.PostgrestFilterBuilder=r.default;const s=n(ps());V.PostgrestTransformBuilder=s.default;const i=n(gs());V.PostgrestBuilder=i.default;const a=n(fs());return V.PostgrestError=a.default,V.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:i.default,PostgrestError:a.default},V}var Vn=Gn();const Yn=qn(Vn),{PostgrestClient:Qn,PostgrestQueryBuilder:No,PostgrestFilterBuilder:Lo,PostgrestTransformBuilder:Do,PostgrestBuilder:Bo,PostgrestError:qo}=Yn;class Xn{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const r=t.node,s=parseInt(r.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Zn="2.75.0",ei=`realtime-js/${Zn}`,ti="1.0.0",Gt=1e4,ri=1e3,si=100;var it;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(it||(it={}));var z;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(z||(z={}));var he;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(he||(he={}));var Vt;(function(n){n.websocket="websocket"})(Vt||(Vt={}));var Re;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(Re||(Re={}));class ni{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=r.decode(e.slice(a,a+s));a=a+s;const c=r.decode(e.slice(a,a+i));a=a+i;const l=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:c,payload:l}}}class _s{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var B;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(B||(B={}));const jr=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((i,a)=>(i[a]=ii(a,n,e,s),i),{}):{}},ii=(n,e,t,r)=>{const s=e.find(o=>o.name===n),i=s?.type,a=t[n];return i&&!r.includes(i)?ws(i,a):Yt(a)},ws=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return ci(e,t)}switch(n){case B.bool:return ai(e);case B.float4:case B.float8:case B.int2:case B.int4:case B.int8:case B.numeric:case B.oid:return oi(e);case B.json:case B.jsonb:return li(e);case B.timestamp:return ui(e);case B.abstime:case B.date:case B.daterange:case B.int4range:case B.int8range:case B.money:case B.reltime:case B.text:case B.time:case B.timestamptz:case B.timetz:case B.tsrange:case B.tstzrange:return Yt(e);default:return Yt(e)}},Yt=n=>n,ai=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},oi=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},li=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},ci=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const a=n.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>ws(e,o))}return n},ui=n=>typeof n=="string"?n.replace(" ","T"):n,ms=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Ut{constructor(e,t,r={},s=Gt){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Cr;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Cr||(Cr={}));class at{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=at.syncState(this.state,s,i,a),this.pendingDiffs.forEach(c=>{this.state=at.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=at.syncDiff(this.state,s,i,a),o())}),this.onJoin((s,i,a)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:a})}),this.onLeave((s,i,a)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),a=this.transformState(t),o={},c={};return this.map(i,(l,u)=>{a[l]||(c[l]=u)}),this.map(a,(l,u)=>{const h=i[l];if(h){const d=u.map(v=>v.presence_ref),g=h.map(v=>v.presence_ref),f=u.filter(v=>g.indexOf(v.presence_ref)<0),p=h.filter(v=>d.indexOf(v.presence_ref)<0);f.length>0&&(o[l]=f),p.length>0&&(c[l]=p)}else o[l]=u}),this.syncDiff(i,{joins:o,leaves:c},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(o,c)=>{var l;const u=(l=e[o])!==null&&l!==void 0?l:[];if(e[o]=this.cloneDeep(c),u.length>0){const h=e[o].map(g=>g.presence_ref),d=u.filter(g=>h.indexOf(g.presence_ref)<0);e[o].unshift(...d)}r(o,u,c)}),this.map(a,(o,c)=>{let l=e[o];if(!l)return;const u=c.map(h=>h.presence_ref);l=l.filter(h=>u.indexOf(h.presence_ref)<0),e[o]=l,s(o,l,c),l.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var xr;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(xr||(xr={}));var ot;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(ot||(ot={}));var we;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(we||(we={}));class cr{constructor(e,t={config:{}},r){var s,i;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=z.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ut(this,he.join,this.params,this.timeout),this.rejoinTimer=new _s(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=z.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=z.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=z.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=z.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=z.errored,this.rejoinTimer.scheduleTimeout())}),this._on(he.reply,{},(a,o)=>{this._trigger(this._replyEventName(o),a)}),this.presence=new at(this),this.broadcastEndpointURL=ms(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==z.closed){const{config:{broadcast:a,presence:o,private:c}}=this.params,l=(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(g=>g.filter))!==null&&s!==void 0?s:[],u=!!this.bindings[ot.PRESENCE]&&this.bindings[ot.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,h={},d={broadcast:a,presence:Object.assign(Object.assign({},o),{enabled:u}),postgres_changes:l,private:c};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(g=>e?.(we.CHANNEL_ERROR,g)),this._onClose(()=>e?.(we.CLOSED)),this.updateJoinPayload(Object.assign({config:d},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:g})=>{var f;if(this.socket.setAuth(),g===void 0){e?.(we.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,v=(f=p?.length)!==null&&f!==void 0?f:0,y=[];for(let _=0;_<v;_++){const w=p[_],{filter:{event:E,schema:A,table:b,filter:S}}=w,x=g&&g[_];if(x&&x.event===E&&x.schema===A&&x.table===b&&x.filter===S)y.push(Object.assign(Object.assign({},w),{id:x.id}));else{this.unsubscribe(),this.state=z.errored,e?.(we.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(we.SUBSCRIBED);return}}).receive("error",g=>{this.state=z.errored,e?.(we.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(g).join(", ")||"error")))}).receive("timeout",()=>{e?.(we.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===z.joined&&e===ot.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const l=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=l.body)===null||s===void 0?void 0:s.cancel()),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,c;const l=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),l.receive("ok",()=>i("ok")),l.receive("error",()=>i("error")),l.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=z.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(he.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new Ut(this,he.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=z.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),a}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Ut(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>si){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const a=e.toLocaleLowerCase(),{close:o,error:c,leave:l,join:u}=he;if(r&&[o,c,l,u].indexOf(a)>=0&&r!==this._joinRef())return;let d=this._onMessage(a,t,r);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(g=>{var f,p,v;return((f=g.filter)===null||f===void 0?void 0:f.event)==="*"||((v=(p=g.filter)===null||p===void 0?void 0:p.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===a}).map(g=>g.callback(d,r)):(i=this.bindings[a])===null||i===void 0||i.filter(g=>{var f,p,v,y,_,w;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in g){const E=g.id,A=(f=g.filter)===null||f===void 0?void 0:f.event;return E&&((p=t.ids)===null||p===void 0?void 0:p.includes(E))&&(A==="*"||A?.toLocaleLowerCase()===((v=t.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const E=(_=(y=g?.filter)===null||y===void 0?void 0:y.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return E==="*"||E===((w=t?.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===a}).map(g=>{if(typeof d=="object"&&"ids"in d){const f=d.data,{schema:p,table:v,commit_timestamp:y,type:_,errors:w}=f;d=Object.assign(Object.assign({},{schema:p,table:v,commit_timestamp:y,eventType:_,new:{},old:{},errors:w}),this._getPayloadRecords(f))}g.callback(d,r)})}_isClosed(){return this.state===z.closed}_isJoined(){return this.state===z.joined}_isJoining(){return this.state===z.joining}_isLeaving(){return this.state===z.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&cr.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(he.close,{},e)}_onError(e){this._on(he.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=z.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=jr(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=jr(e.columns,e.old_record)),t}}const Nt=()=>{},vt={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},hi=[1e3,2e3,5e3,1e4],di=1e4,fi=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class gi{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Gt,this.transport=null,this.heartbeatIntervalMs=vt.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Nt,this.ref=0,this.reconnectTimer=null,this.logger=Nt,this.conn=null,this.sendBuffer=[],this.serializer=new ni,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let i;return s?i=s:typeof fetch>"u"?i=(...a)=>ht(async()=>{const{default:o}=await Promise.resolve().then(()=>Ze);return{default:o}},void 0).then(({default:o})=>o(...a)).catch(o=>{throw new Error(`Failed to load @supabase/node-fetch: ${o.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...a)=>i(...a)},!(!((r=t?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Vt.websocket}`,this.httpEndpoint=ms(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Xn.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:ti}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case it.connecting:return Re.Connecting;case it.open:return Re.Open;case it.closing:return Re.Closing;default:return Re.Closed}}isConnected(){return this.connectionState()===Re.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===r);if(s)return s;{const i=new cr(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:r,payload:s,ref:i}=e,a=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${t} ${r} (${i})`,s),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(ri,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},vt.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(l){this.log("error","error in heartbeat callback",l)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:s,payload:i,ref:a}=t,o=a?`(${a})`:"",c=i.status||"";this.log("receive",`${c} ${r} ${s} ${o}`.trim(),i),this.channels.filter(l=>l._isMember(r)).forEach(l=>l._trigger(s,i,a)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(he.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([fi],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const s={access_token:t,version:ei};t&&r.updateJoinPayload(s),r.joinedOnce&&r._isJoined()&&r._push(he.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new _s(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},vt.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,i,a,o,c,l,u;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e?.timeout)!==null&&r!==void 0?r:Gt,this.heartbeatIntervalMs=(s=e?.heartbeatIntervalMs)!==null&&s!==void 0?s:vt.HEARTBEAT_INTERVAL,this.worker=(i=e?.worker)!==null&&i!==void 0?i:!1,this.accessToken=(a=e?.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(o=e?.heartbeatCallback)!==null&&o!==void 0?o:Nt,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e?.reconnectAfterMs)!==null&&c!==void 0?c:(h=>hi[h-1]||di),this.encode=(l=e?.encode)!==null&&l!==void 0?l:((h,d)=>d(JSON.stringify(h))),this.decode=(u=e?.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class ur extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function K(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class pi extends ur{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Qt extends ur{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var vi=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};const bs=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>ht(async()=>{const{default:r}=await Promise.resolve().then(()=>Ze);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},_i=()=>vi(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ht(()=>Promise.resolve().then(()=>Ze),void 0)).Response:Response}),Xt=n=>{if(Array.isArray(n))return n.map(t=>Xt(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=Xt(r)}),e},wi=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var Ie=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};const Lt=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),mi=(n,e,t)=>Ie(void 0,void 0,void 0,function*(){const r=yield _i();n instanceof r&&!t?.noResolveJson?n.json().then(s=>{const i=n.status||500,a=s?.statusCode||i+"";e(new pi(Lt(s),i,a))}).catch(s=>{e(new Qt(Lt(s),s))}):e(new Qt(Lt(n),n))}),bi=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"||!r?s:(wi(r)?(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s.body=JSON.stringify(r)):s.body=r,e?.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),t))};function dt(n,e,t,r,s,i){return Ie(this,void 0,void 0,function*(){return new Promise((a,o)=>{n(t,bi(e,r,s,i)).then(c=>{if(!c.ok)throw c;return r?.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>mi(c,o,r))})})}function St(n,e,t,r){return Ie(this,void 0,void 0,function*(){return dt(n,"GET",e,t,r)})}function ge(n,e,t,r,s){return Ie(this,void 0,void 0,function*(){return dt(n,"POST",e,r,s,t)})}function Zt(n,e,t,r,s){return Ie(this,void 0,void 0,function*(){return dt(n,"PUT",e,r,s,t)})}function yi(n,e,t,r){return Ie(this,void 0,void 0,function*(){return dt(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function ys(n,e,t,r,s){return Ie(this,void 0,void 0,function*(){return dt(n,"DELETE",e,r,s,t)})}var Ei=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};class Si{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return Ei(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(K(e))return{data:null,error:e};throw e}})}}var ki=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};class Ti{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}asStream(){return new Si(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.execute().then(e,t)}execute(){return ki(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(K(e))return{data:null,error:e};throw e}})}}var se=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};const Oi={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ir={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Ai{constructor(e,t={},r,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=bs(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,r,s){return se(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},Ir),s);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=r,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),s?.headers&&(o=Object.assign(Object.assign({},o),s.headers));const l=this._removeEmptyFolders(t),u=this._getFinalPath(l),h=yield(e=="PUT"?Zt:ge)(this.fetch,`${this.url}/object/${u}`,i,Object.assign({headers:o},a?.duplex?{duplex:a.duplex}:{}));return{data:{path:l,id:h.Id,fullPath:h.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(K(i))return{data:null,error:i};throw i}})}upload(e,t,r){return se(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return se(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let c;const l=Object.assign({upsert:Ir.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",l.cacheControl)):(c=r,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);const h=yield Zt(this.fetch,o.toString(),c,{headers:u});return{data:{path:i,fullPath:h.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(K(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return se(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t?.upsert&&(s["x-upsert"]="true");const i=yield ge(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),a=new URL(this.url+i.url),o=a.searchParams.get("token");if(!o)throw new ur("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(K(r))return{data:null,error:r};throw r}})}update(e,t,r){return se(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return se(this,void 0,void 0,function*(){try{return{data:yield ge(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(K(s))return{data:null,error:s};throw s}})}copy(e,t,r){return se(this,void 0,void 0,function*(){try{return{data:{path:(yield ge(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(K(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return se(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield ge(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r?.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(K(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return se(this,void 0,void 0,function*(){try{const s=yield ge(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(K(s))return{data:null,error:s};throw s}})}download(e,t){const s=typeof t?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(t?.transform||{}),a=i?`?${i}`:"",o=this._getFinalPath(e),c=()=>St(this.fetch,`${this.url}/${s}/${o}${a}`,{headers:this.headers,noResolveJson:!0});return new Ti(c,this.shouldThrowOnError)}info(e){return se(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield St(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Xt(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(K(r))return{data:null,error:r};throw r}})}exists(e){return se(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield yi(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(K(r)&&r instanceof Qt){const s=r.originalError;if([400,404].includes(s?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t?.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const o=typeof t?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(t?.transform||{});c!==""&&s.push(c);let l=s.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${r}${l}`)}}}remove(e){return se(this,void 0,void 0,function*(){try{return{data:yield ys(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(K(t))return{data:null,error:t};throw t}})}list(e,t,r){return se(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Oi),t),{prefix:e||""});return{data:yield ge(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(K(s))return{data:null,error:s};throw s}})}listV2(e,t){return se(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield ge(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(K(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Ri="2.75.0",Pi={"X-Client-Info":`storage-js/${Ri}`};var Me=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};class ji{constructor(e,t={},r,s){this.shouldThrowOnError=!1;const i=new URL(e);s?.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Pi),t),this.fetch=bs(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return Me(this,void 0,void 0,function*(){try{return{data:yield St(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(K(e))return{data:null,error:e};throw e}})}getBucket(e){return Me(this,void 0,void 0,function*(){try{return{data:yield St(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(K(t))return{data:null,error:t};throw t}})}createBucket(e){return Me(this,arguments,void 0,function*(t,r={public:!1}){try{return{data:yield ge(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(K(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return Me(this,void 0,void 0,function*(){try{return{data:yield Zt(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(K(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Me(this,void 0,void 0,function*(){try{return{data:yield ge(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(K(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Me(this,void 0,void 0,function*(){try{return{data:yield ys(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(K(t))return{data:null,error:t};throw t}})}}class Ci extends ji{constructor(e,t={},r,s){super(e,t,r,s)}from(e){return new Ai(this.url,this.headers,e,this.fetch)}}const xi="2.75.0";let tt="";typeof Deno<"u"?tt="deno":typeof document<"u"?tt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?tt="react-native":tt="node";const Ii={"X-Client-Info":`supabase-js-${tt}/${xi}`},$i={headers:Ii},Ui={schema:"public"},Ni={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Li={};var Di=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};const Bi=n=>{let e;return n?e=n:typeof fetch>"u"?e=hs:e=fetch,(...t)=>e(...t)},qi=()=>typeof Headers>"u"?ds:Headers,Mi=(n,e,t)=>{const r=Bi(t),s=qi();return(i,a)=>Di(void 0,void 0,void 0,function*(){var o;const c=(o=yield e())!==null&&o!==void 0?o:n;let l=new s(a?.headers);return l.has("apikey")||l.set("apikey",n),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},a),{headers:l}))})};var Fi=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};function Wi(n){return n.endsWith("/")?n:n+"/"}function Ki(n,e){var t,r;const{db:s,auth:i,realtime:a,global:o}=n,{db:c,auth:l,realtime:u,global:h}=e,d={db:Object.assign(Object.assign({},c),s),auth:Object.assign(Object.assign({},l),i),realtime:Object.assign(Object.assign({},u),a),storage:{},global:Object.assign(Object.assign(Object.assign({},h),o),{headers:Object.assign(Object.assign({},(t=h?.headers)!==null&&t!==void 0?t:{}),(r=o?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>Fi(this,void 0,void 0,function*(){return""})};return n.accessToken?d.accessToken=n.accessToken:delete d.accessToken,d}function Hi(n){const e=n?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Wi(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const Es="2.75.0",Ge=30*1e3,er=3,Dt=er*Ge,zi="http://localhost:9999",Ji="supabase.auth.token",Gi={"X-Client-Info":`gotrue-js/${Es}`},tr="X-Supabase-Api-Version",Ss={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Vi=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Yi=600*1e3;class ct extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function T(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class Qi extends ct{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function Xi(n){return T(n)&&n.name==="AuthApiError"}class Pe extends ct{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Se extends ct{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class ye extends Se{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Zi(n){return T(n)&&n.name==="AuthSessionMissingError"}class Fe extends Se{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class _t extends Se{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class wt extends Se{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function ea(n){return T(n)&&n.name==="AuthImplicitGrantRedirectError"}class $r extends Se{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class rr extends Se{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Bt(n){return T(n)&&n.name==="AuthRetryableFetchError"}class Ur extends Se{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class sr extends Se{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const kt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Nr=` 	
\r=`.split(""),ta=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<Nr.length;e+=1)n[Nr[e].charCodeAt(0)]=-2;for(let e=0;e<kt.length;e+=1)n[kt[e].charCodeAt(0)]=e;return n})();function Lr(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(kt[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(kt[r]),e.queuedBits-=6}}function ks(n,e,t){const r=ta[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Dr(n){const e=[],t=a=>{e.push(String.fromCodePoint(a))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=a=>{na(a,r,t)};for(let a=0;a<n.length;a+=1)ks(n.charCodeAt(a),s,i);return e.join("")}function ra(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function sa(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}ra(r,e)}}function na(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if((n>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Qe(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<n.length;s+=1)ks(n.charCodeAt(s),t,r);return new Uint8Array(e)}function ia(n){const e=[];return sa(n,t=>e.push(t)),new Uint8Array(e)}function xe(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};return n.forEach(s=>Lr(s,t,r)),Lr(null,t,r),e.join("")}function aa(n){return Math.round(Date.now()/1e3)+n}function oa(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const ie=()=>typeof window<"u"&&typeof document<"u",Te={tested:!1,writable:!1},Ts=()=>{if(!ie())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Te.tested)return Te.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Te.tested=!0,Te.writable=!0}catch{Te.tested=!0,Te.writable=!1}return Te.writable};function la(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const Os=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>ht(async()=>{const{default:r}=await Promise.resolve().then(()=>Ze);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},ca=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Ve=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Oe=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},be=async(n,e)=>{await n.removeItem(e)};class xt{constructor(){this.promise=new xt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}xt.promiseConstructor=Promise;function qt(n){const e=n.split(".");if(e.length!==3)throw new sr("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Vi.test(e[r]))throw new sr("JWT not in base64url format");return{header:JSON.parse(Dr(e[0])),payload:JSON.parse(Dr(e[1])),signature:Qe(e[2]),raw:{header:e[0],payload:e[1]}}}async function ua(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function ha(n,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await n(i);if(!e(i,null,a)){r(a);return}}catch(a){if(!e(i,a)){s(a);return}}})()})}function da(n){return("0"+n.toString(16)).substr(-2)}function fa(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,da).join("")}async function ga(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function pa(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await ga(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function We(n,e,t=!1){const r=fa();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await Ve(n,`${e}-code-verifier`,s);const i=await pa(r);return[i,r===i?"plain":"s256"]}const va=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function _a(n){const e=n.headers.get(tr);if(!e||!e.match(va))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function wa(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function ma(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const ba=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ke(n){if(!ba.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Mt(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Br(n){return JSON.parse(JSON.stringify(n))}var ya=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const Ae=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Ea=[502,503,504];async function qr(n){var e;if(!ca(n))throw new rr(Ae(n),0);if(Ea.includes(n.status))throw new rr(Ae(n),n.status);let t;try{t=await n.json()}catch(i){throw new Pe(Ae(i),i)}let r;const s=_a(n);if(s&&s.getTime()>=Ss["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Ur(Ae(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new ye}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new Ur(Ae(t),n.status,t.weak_password.reasons);throw new Qi(Ae(t),n.status||500,r)}const Sa=(n,e,t,r)=>{const s={method:n,headers:e?.headers||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function j(n,e,t,r){var s;const i=Object.assign({},r?.headers);i[tr]||(i[tr]=Ss["2024-01-01"].name),r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const a=(s=r?.query)!==null&&s!==void 0?s:{};r?.redirectTo&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await ka(n,e,t+o,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(c):{data:Object.assign({},c),error:null}}async function ka(n,e,t,r,s,i){const a=Sa(e,r,s,i);let o;try{o=await n(t,Object.assign({},a))}catch(c){throw console.error(c),new rr(Ae(c),0)}if(o.ok||await qr(o),r?.noResolveJson)return o;try{return await o.json()}catch(c){await qr(c)}}function ue(n){var e;let t=null;Aa(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=aa(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Mr(n){const e=ue(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Ee(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Ta(n){return{data:n,error:null}}function Oa(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,a=ya(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},a);return{data:{properties:o,user:c},error:null}}function Fr(n){return n}function Aa(n){return n.access_token&&n.refresh_token&&n.expires_in}const Ft=["global","local","others"];var Ra=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class Pa{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Os(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Ft[0]){if(Ft.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ft.join(", ")}`);try{return await j(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(T(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await j(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ee})}catch(r){if(T(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Ra(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r?.newEmail,delete s.newEmail),await j(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Oa,redirectTo:t?.redirectTo})}catch(t){if(T(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await j(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ee})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,i,a,o,c;try{const l={nextPage:null,lastPage:0,total:0},u=await j(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Fr});if(u.error)throw u.error;const h=await u.json(),d=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,g=(c=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return g.length>0&&(g.forEach(f=>{const p=parseInt(f.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(f.split(";")[1].split("=")[1]);l[`${v}Page`]=p}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(l){if(T(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){Ke(e);try{return await j(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ee})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Ke(e);try{return await j(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ee})}catch(r){if(T(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){Ke(e);try{return await j(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ee})}catch(r){if(T(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Ke(e.userId);try{const{data:t,error:r}=await j(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(T(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Ke(e.userId),Ke(e.id);try{return{data:await j(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,r,s,i,a,o,c;try{const l={nextPage:null,lastPage:0,total:0},u=await j(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Fr});if(u.error)throw u.error;const h=await u.json(),d=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,g=(c=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return g.length>0&&(g.forEach(f=>{const p=parseInt(f.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(f.split(";")[1].split("=")[1]);l[`${v}Page`]=p}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(l){if(T(l))return{data:{clients:[]},error:l};throw l}}async _createOAuthClient(e){try{return await j(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await j(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _deleteOAuthClient(e){try{return await j(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await j(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(T(t))return{data:null,error:t};throw t}}}function Wr(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}const He={debug:!!(globalThis&&Ts()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class As extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ja extends As{}async function Ca(n,e,t){He.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),He.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){He.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{He.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw He.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new ja(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(He.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function xa(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Rs(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function Ia(n){return parseInt(n,16)}function $a(n){const e=new TextEncoder().encode(n);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function Ua(n){var e;const{chainId:t,domain:r,expirationTime:s,issuedAt:i=new Date,nonce:a,notBefore:o,requestId:c,resources:l,scheme:u,uri:h,version:d}=n;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(d!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(!((e=n.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const g=Rs(n.address),f=u?`${u}://${r}`:r,p=n.statement?`${n.statement}
`:"",v=`${f} wants you to sign in with your Ethereum account:
${g}

${p}`;let y=`URI: ${h}
Version: ${d}
Chain ID: ${t}${a?`
Nonce: ${a}`:""}
Issued At: ${i.toISOString()}`;if(s&&(y+=`
Expiration Time: ${s.toISOString()}`),o&&(y+=`
Not Before: ${o.toISOString()}`),c&&(y+=`
Request ID: ${c}`),l){let _=`
Resources:`;for(const w of l){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);_+=`
- ${w}`}y+=_}return`${v}
${y}`}class W extends Error{constructor({message:e,code:t,cause:r,name:s}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=s??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=t}}class Tt extends W{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Na({error:n,options:e}){var t,r,s;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new W({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((t=i.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new W({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(e.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new W({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new W({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new W({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new W({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return i.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new W({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new W({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const a=window.location.hostname;if(js(a)){if(i.rp.id!==a)return new W({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new W({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new W({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new W({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new W({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function La({error:n,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new W({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new W({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const r=window.location.hostname;if(js(r)){if(t.rpId!==r)return new W({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new W({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new W({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new W({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}var Ps=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class Da{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const Ba=new Da;function qa(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:e,user:t,excludeCredentials:r}=n,s=Ps(n,["challenge","user","excludeCredentials"]),i=Qe(e).buffer,a=Object.assign(Object.assign({},t),{id:Qe(t.id).buffer}),o=Object.assign(Object.assign({},s),{challenge:i,user:a});if(r&&r.length>0){o.excludeCredentials=new Array(r.length);for(let c=0;c<r.length;c++){const l=r[c];o.excludeCredentials[c]=Object.assign(Object.assign({},l),{id:Qe(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return o}function Ma(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:e,allowCredentials:t}=n,r=Ps(n,["challenge","allowCredentials"]),s=Qe(e).buffer,i=Object.assign(Object.assign({},r),{challenge:s});if(t&&t.length>0){i.allowCredentials=new Array(t.length);for(let a=0;a<t.length;a++){const o=t[a];i.allowCredentials[a]=Object.assign(Object.assign({},o),{id:Qe(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return i}function Fa(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const t=n;return{id:n.id,rawId:n.id,response:{attestationObject:xe(new Uint8Array(n.response.attestationObject)),clientDataJSON:xe(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Wa(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const t=n,r=n.getClientExtensionResults(),s=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:xe(new Uint8Array(s.authenticatorData)),clientDataJSON:xe(new Uint8Array(s.clientDataJSON)),signature:xe(new Uint8Array(s.signature)),userHandle:s.userHandle?xe(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function js(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function Kr(){var n,e;return!!(ie()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator?.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function Ka(n){try{const e=await navigator.credentials.create(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Tt("Browser returned unexpected credential type",e)}:{data:null,error:new Tt("Empty credential response",e)}}catch(e){return{data:null,error:Na({error:e,options:n})}}}async function Ha(n){try{const e=await navigator.credentials.get(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Tt("Browser returned unexpected credential type",e)}:{data:null,error:new Tt("Empty credential response",e)}}catch(e){return{data:null,error:La({error:e,options:n})}}}const za={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},Ja={userVerification:"preferred",hints:["security-key"]};function Ot(...n){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),t=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),r={};for(const s of n)if(s)for(const i in s){const a=s[i];if(a!==void 0)if(Array.isArray(a))r[i]=a;else if(t(a))r[i]=a;else if(e(a)){const o=r[i];e(o)?r[i]=Ot(o,a):r[i]=Ot(a)}else r[i]=a}return r}function Ga(n,e){return Ot(za,n,e||{})}function Va(n,e){return Ot(Ja,n,e||{})}class Ya{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:r,signal:s},i){try{const{data:a,error:o}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!a)return{data:null,error:o};const c=s??Ba.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:l}=a.webauthn.credential_options.publicKey;l.name||(l.name=`${l.id}:${r}`),l.displayName||(l.displayName=l.name)}switch(a.webauthn.type){case"create":{const l=Ga(a.webauthn.credential_options.publicKey,i?.create),{data:u,error:h}=await Ka({publicKey:l,signal:c});return u?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}case"request":{const l=Va(a.webauthn.credential_options.publicKey,i?.request),{data:u,error:h}=await Ha(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:l,signal:c}));return u?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}}}catch(a){return T(a)?{data:null,error:a}:{data:null,error:new Pe("Unexpected error in challenge",a)}}}async _verify({challengeId:e,factorId:t,webauthn:r}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s}},i){if(!t)return{data:null,error:new ct("rpId is required for WebAuthn authentication")};try{if(!Kr())return{data:null,error:new Pe("Browser does not support WebAuthn",null)};const{data:a,error:o}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:r},signal:s},{request:i});if(!a)return{data:null,error:o};const{webauthn:c}=a;return this._verify({factorId:e,challengeId:a.challengeId,webauthn:{type:c.type,rpId:t,rpOrigins:r,credential_response:c.credential_response}})}catch(a){return T(a)?{data:null,error:a}:{data:null,error:new Pe("Unexpected error in authenticate",a)}}}async _register({friendlyName:e,rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s},i){if(!t)return{data:null,error:new ct("rpId is required for WebAuthn registration")};try{if(!Kr())return{data:null,error:new Pe("Browser does not support WebAuthn",null)};const{data:a,error:o}=await this._enroll({friendlyName:e});if(!a)return await this.client.mfa.listFactors().then(u=>{var h;return(h=u.data)===null||h===void 0?void 0:h.all.find(d=>d.factor_type==="webauthn"&&d.friendly_name===e&&d.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u?.id}):void 0),{data:null,error:o};const{data:c,error:l}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:t,rpOrigins:r},signal:s},{create:i});return c?this._verify({factorId:a.id,challengeId:c.challengeId,webauthn:{rpId:t,rpOrigins:r,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:l}}catch(a){return T(a)?{data:null,error:a}:{data:null,error:new Pe("Unexpected error in register",a)}}}}xa();const Qa={url:zi,storageKey:Ji,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Gi,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Hr(n,e,t){return await t()}const ze={};class ut{get jwks(){var e,t;return(t=(e=ze[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){ze[this.storageKey]=Object.assign(Object.assign({},ze[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=ze[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){ze[this.storageKey]=Object.assign(Object.assign({},ze[this.storageKey]),{cachedAt:e})}constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ut.nextInstanceID,ut.nextInstanceID+=1,this.instanceID>0&&ie()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Qa),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Pa({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Os(s.fetch),this.lock=s.lock||Hr,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:ie()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Ca:this.lock=Hr,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Ya(this)},this.persistSession?(s.storage?this.storage=s.storage:Ts()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Wr(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=Wr(this.memoryStorage)),ie()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Es}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=la(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),ie()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),ea(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:o}=s;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return T(t)?{error:t}:{error:new Pe("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const i=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:ue}),{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(T(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,r,s;try{let i;if("email"in e){const{email:u,password:h,options:d}=e;let g=null,f=null;this.flowType==="pkce"&&([g,f]=await We(this.storage,this.storageKey)),i=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d?.emailRedirectTo,body:{email:u,password:h,data:(t=d?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:d?.captchaToken},code_challenge:g,code_challenge_method:f},xform:ue})}else if("phone"in e){const{phone:u,password:h,options:d}=e;i=await j(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=d?.data)!==null&&r!==void 0?r:{},channel:(s=d?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:ue})}else throw new _t("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(T(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await j(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:Mr})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await j(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:Mr})}else throw new _t("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Fe}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,r,s,i,a,o,c,l,u,h,d;let g,f;if("message"in e)g=e.message,f=e.signature;else{const{chain:p,wallet:v,statement:y,options:_}=e;let w;if(ie())if(typeof v=="object")w=v;else{const H=window;if("ethereum"in H&&typeof H.ethereum=="object"&&"request"in H.ethereum&&typeof H.ethereum.request=="function")w=H.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!_?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=v}const E=new URL((t=_?.url)!==null&&t!==void 0?t:window.location.href),A=await w.request({method:"eth_requestAccounts"}).then(H=>H).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!A||A.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const b=Rs(A[0]);let S=(r=_?.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!S){const H=await w.request({method:"eth_chainId"});S=Ia(H)}const x={domain:E.host,address:b,statement:y,uri:E.href,version:"1",chainId:S,nonce:(s=_?.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(a=(i=_?.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(o=_?.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(c=_?.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(l=_?.signInWithEthereum)===null||l===void 0?void 0:l.requestId,resources:(u=_?.signInWithEthereum)===null||u===void 0?void 0:u.resources};g=Ua(x),f=await w.request({method:"personal_sign",params:[$a(g),b]})}try{const{data:p,error:v}=await j(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:g,signature:f},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(d=e.options)===null||d===void 0?void 0:d.captchaToken}}:null),xform:ue});if(v)throw v;return!p||!p.session||!p.user?{data:{user:null,session:null},error:new Fe}:(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),{data:Object.assign({},p),error:v})}catch(p){if(T(p))return{data:{user:null,session:null},error:p};throw p}}async signInWithSolana(e){var t,r,s,i,a,o,c,l,u,h,d,g;let f,p;if("message"in e)f=e.message,p=e.signature;else{const{chain:v,wallet:y,statement:_,options:w}=e;let E;if(ie())if(typeof y=="object")E=y;else{const b=window;if("solana"in b&&typeof b.solana=="object"&&("signIn"in b.solana&&typeof b.solana.signIn=="function"||"signMessage"in b.solana&&typeof b.solana.signMessage=="function"))E=b.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!w?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=y}const A=new URL((t=w?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in E&&E.signIn){const b=await E.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w?.signInWithSolana),{version:"1",domain:A.host,uri:A.href}),_?{statement:_}:null));let S;if(Array.isArray(b)&&b[0]&&typeof b[0]=="object")S=b[0];else if(b&&typeof b=="object"&&"signedMessage"in b&&"signature"in b)S=b;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in S&&"signature"in S&&(typeof S.signedMessage=="string"||S.signedMessage instanceof Uint8Array)&&S.signature instanceof Uint8Array)f=typeof S.signedMessage=="string"?S.signedMessage:new TextDecoder().decode(S.signedMessage),p=S.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in E)||typeof E.signMessage!="function"||!("publicKey"in E)||typeof E!="object"||!E.publicKey||!("toBase58"in E.publicKey)||typeof E.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${A.host} wants you to sign in with your Solana account:`,E.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${A.href}`,`Issued At: ${(s=(r=w?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=w?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((a=w?.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((o=w?.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((c=w?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((l=w?.signInWithSolana)===null||l===void 0)&&l.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((h=(u=w?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...w.signInWithSolana.resources.map(S=>`- ${S}`)]:[]].join(`
`);const b=await E.signMessage(new TextEncoder().encode(f),"utf8");if(!b||!(b instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=b}}try{const{data:v,error:y}=await j(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:xe(p)},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:ue});if(y)throw y;return!v||!v.session||!v.user?{data:{user:null,session:null},error:new Fe}:(v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),{data:Object.assign({},v),error:y})}catch(v){if(T(v))return{data:{user:null,session:null},error:v};throw v}}async _exchangeCodeForSession(e){const t=await Oe(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:i,error:a}=await j(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:ue});if(await be(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Fe}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:a})}catch(i){if(T(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:i,nonce:a}=e,o=await j(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:ue}),{data:c,error:l}=o;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Fe}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,i,a;try{if("email"in e){const{email:o,options:c}=e;let l=null,u=null;this.flowType==="pkce"&&([l,u]=await We(this.storage,this.storageKey));const{error:h}=await j(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=c?.data)!==null&&t!==void 0?t:{},create_user:(r=c?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:o,options:c}=e,{data:l,error:u}=await j(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(s=c?.data)!==null&&s!==void 0?s:{},create_user:(i=c?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(a=c?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:l?.message_id},error:u}}throw new _t("You must provide either an email or phone number.")}catch(o){if(T(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,r;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:o}=await j(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:ue});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,l=a.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(s){if(T(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await We(this.storage,this.storageKey)),await j(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:Ta})}catch(i){if(T(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new ye;const{error:s}=await j(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(T(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:a}=await j(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:a,error:o}=await j(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:o}}throw new _t("You must provide either an email or phone number and a type")}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Oe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Dt:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const a=await Oe(this.userStorage,this.storageKey+"-user");a?.user?e.user=a.user:e.user=Mt()}if(this.storage.isServer&&e.user){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,l,u)=>(!a&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,l,u))})}return{data:{session:e},error:null}}const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await j(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ee}):await this._useSession(async t=>{var r,s,i;const{data:a,error:o}=t;if(o)throw o;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ye}:await j(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:Ee})})}catch(t){if(T(t))return Zi(t)&&(await this._removeSession(),await be(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new ye;const a=s.session;let o=null,c=null;this.flowType==="pkce"&&e.email!=null&&([o,c]=await We(this.storage,this.storageKey));const{data:l,error:u}=await j(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:a.access_token,xform:Ee});if(u)throw u;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(r){if(T(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ye;const t=Date.now()/1e3;let r=t,s=!0,i=null;const{payload:a}=qt(e.access_token);if(a.exp&&(r=a.exp,s=r<=t),s){const{data:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(T(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new ye;const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!ie())throw new wt("No browser detected.");if(e.error||e.error_description||e.error_code)throw new wt(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new $r("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new wt("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new $r("No code detected.");const{data:_,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:a,expires_in:o,expires_at:c,token_type:l}=e;if(!i||!o||!a||!l)throw new wt("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(o);let d=u+h;c&&(d=parseInt(c));const g=d-u;g*1e3<=Ge&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${h}s`);const f=d-h;u-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,d,u):u-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,d,u);const{data:p,error:v}=await this._getUser(i);if(v)throw v;const y={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:h,expires_at:d,refresh_token:a,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:e.type},error:null}}catch(r){if(T(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Oe(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{error:i};const a=(r=s.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(Xi(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await be(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=oa(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:i},error:a}=t;if(a)throw a;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await We(this.storage,this.storageKey,!0));try{return await j(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(T(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:r,error:s}=await this._useSession(async i=>{var a,o,c,l,u;const{data:h,error:d}=i;if(d)throw d;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await j(this.fetch,"GET",g,{headers:this.headers,jwt:(u=(l=h.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return ie()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(T(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var r;try{const{error:s,data:{session:i}}=t;if(s)throw s;const{options:a,provider:o,token:c,access_token:l,nonce:u}=e,h=await j(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i?.access_token)!==null&&r!==void 0?r:void 0,body:{provider:o,id_token:c,access_token:l,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:ue}),{data:d,error:g}=h;return g?{data:{user:null,session:null},error:g}:!d||!d.session||!d.user?{data:{user:null,session:null},error:new Fe}:(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("USER_UPDATED",d.session)),{data:d,error:g})}catch(s){if(T(s))return{data:{user:null,session:null},error:s};throw s}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:a}=t;if(a)throw a;return await j(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await ha(async s=>(s>0&&await ua(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await j(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ue})),(s,i)=>{const a=200*Math.pow(2,s);return i&&Bt(i)&&Date.now()+a-r<Ge})}catch(r){if(this._debug(t,"error",r),T(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),ie()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const s=await Oe(this.storage,this.storageKey);if(s&&this.userStorage){let a=await Oe(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:s.user},await Ve(this.userStorage,this.storageKey+"-user",a)),s.user=(e=a?.user)!==null&&e!==void 0?e:Mt()}else if(s&&!s.user&&!s.user){const a=await Oe(this.storage,this.storageKey+"-user");a&&a?.user?(s.user=a.user,await be(this.storage,this.storageKey+"-user"),await Ve(this.storage,this.storageKey,s)):s.user=Mt()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),s!==null&&await this._removeSession();return}const i=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Dt;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${Dt}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),Bt(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:o}=await this._getUser(s.access_token);!o&&a?.user?(s.user=a.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(r,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(r,"error",s),console.error(s);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new ye;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new xt;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new ye;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={data:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(s,"error",i),T(i)){const a={data:null,error:i};return Bt(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await Ve(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const i=Br(s);await Ve(this.storage,this.storageKey,i)}else{const s=Br(t);await Ve(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await be(this.storage,this.storageKey),await be(this.storage,this.storageKey+"-code-verifier"),await be(this.storage,this.storageKey+"-user"),this.userStorage&&await be(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ie()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ge);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/Ge);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Ge}ms, refresh threshold is ${er} ticks`),s<=er&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof As)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ie()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,a]=await We(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});s.push(o.toString())}if(r?.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r?.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await j(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:l}=await j(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(e.factorType==="totp"&&c.type==="totp"&&(!((s=c?.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{data:null,error:i};const a=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?Fa(e.webauthn.credential_response):Wa(e.webauthn.credential_response)})}:{code:e.code}),{data:o,error:c}=await j(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:a,headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:c})})}catch(t){if(T(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{data:null,error:i};const a=await j(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});if(a.error)return a;const{data:o}=a;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:qa(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:Ma(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(T(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=t?.factors)!==null&&e!==void 0?e:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=qt(s.access_token);let o=null;a.aal&&(o=a.aal);let c=o;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const u=a.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(o=>o.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(o=>o.kid===e),r&&this.jwks_cached_at+Yi>s)return r;const{data:i,error:a}=await j(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,r=i.keys.find(o=>o.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:g,error:f}=await this.getSession();if(f||!g.session)return{data:null,error:f};r=g.session.access_token}const{header:s,payload:i,signature:a,raw:{header:o,payload:c}}=qt(r);t?.allowExpired||wa(i.exp);const l=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!l){const{error:g}=await this.getUser(r);if(g)throw g;return{data:{claims:i,header:s,signature:a},error:null}}const u=ma(s.alg),h=await crypto.subtle.importKey("jwk",l,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,a,ia(`${o}.${c}`)))throw new sr("Invalid JWT signature");return{data:{claims:i,header:s,signature:a},error:null}}catch(r){if(T(r))return{data:null,error:r};throw r}}}ut.nextInstanceID=0;const Xa=ut;class Za extends Xa{constructor(e){super(e)}}var eo=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(r.next(u))}catch(h){a(h)}}function c(u){try{l(r.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):s(u.value).then(o,c)}l((r=r.apply(n,e||[])).next())})};class to{constructor(e,t,r){var s,i,a;this.supabaseUrl=e,this.supabaseKey=t;const o=Hi(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const c=`sb-${o.hostname.split(".")[0]}-auth-token`,l={db:Ui,realtime:Li,auth:Object.assign(Object.assign({},Ni),{storageKey:c}),global:$i},u=Ki(r??{},l);this.storageKey=(s=u.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=u.auth)!==null&&a!==void 0?a:{},this.headers,u.global.fetch),this.fetch=Mi(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new Qn(new URL("rest/v1",o).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new Ci(this.storageUrl.href,this.headers,this.fetch,r?.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new Bn(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return eo(this,void 0,void 0,function*(){var e,t;if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:i,storageKey:a,flowType:o,lock:c,debug:l},u,h){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Za({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),u),storageKey:a,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:i,flowType:o,lock:c,debug:l,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(g=>g.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new gi(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const ro=(n,e,t)=>new to(n,e,t);function so(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}so()&&console.warn("â ï¸  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const no="https://kktezqkgtlzzkhmcnmbb.supabase.co",io="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtrdGV6cWtndGx6emtobWNubWJiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAxMDM5NzMsImV4cCI6MjA3NTY3OTk3M30.t6ImSwkDg4_7sjv18UiyZDINn6jrKmwZje-7ujKjA70",Wt=ro(no,io),ao=n=>n;function oo(n,{delay:e=0,duration:t=400,easing:r=ao}={}){const s=+getComputedStyle(n).opacity;return{delay:e,duration:t,easing:r,css:i=>`opacity: ${i*s}`}}var lo=D('<img class="w-24 h-24 md:w-28 md:h-28 object-cover rounded-2xl border shrink-0"/>'),co=D("<span>Reservado por <strong> </strong></span>"),uo=D('<button class="px-3 py-2 rounded-xl text-sm font-medium bg-white border hover:bg-zinc-50 disabled:opacity-60">Quitar reserva</button>'),ho=D('<button class="px-3 py-2 rounded-xl text-sm font-medium bg-zinc-300 text-zinc-700 cursor-not-allowed" disabled>Reservado</button>'),fo=D('<button class="px-3 py-2 rounded-xl text-sm font-medium bg-zinc-900 text-white hover:bg-zinc-800 disabled:opacity-60"> </button>'),go=D('<p class="text-sm opacity-80 mt-1 line-clamp-3"> </p>'),po=D('<span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-zinc-100 border"> </span>'),vo=D('<a target="_blank" rel="noreferrer" class="underline">Ver enlace</a>'),_o=D('<span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-amber-50 border border-amber-200"> </span>'),wo=D('<div class="flex flex-wrap gap-2 mt-2 text-xs md:text-sm opacity-80"></div>'),mo=D("<span>Reservado por <strong> </strong></span>"),bo=D('<button class="px-3 py-2 rounded-xl text-sm font-medium bg-white border hover:bg-zinc-50 disabled:opacity-60">Quitar reserva</button>'),yo=D('<button class="px-3 py-2 rounded-xl text-sm font-medium bg-zinc-300 text-zinc-700 cursor-not-allowed" disabled>Reservado</button>'),Eo=D('<button class="px-3 py-2 rounded-xl text-sm font-medium bg-zinc-900 text-white hover:bg-zinc-800 disabled:opacity-60"> </button>'),So=D('<div><div class="flex items-start gap-3"><!> <div class="md:hidden flex flex-col items-start gap-2"><!> <!></div></div> <div class="flex-1 min-w-0"><h3 class="font-semibold text-lg md:text-xl leading-tight line-clamp-2"> </h3> <!> <div class="flex flex-wrap gap-2 mt-2 text-xs md:text-sm opacity-80"><!> <!> <!></div></div> <div class="hidden md:flex flex-col items-end gap-2"><!> <!></div></div>');function ko(n,e){jt(e,!1);let t=Ce(e,"gift",8),r=Ce(e,"onClaim",8),s=Ce(e,"onUnclaim",8),i=Ce(e,"who",8,null),a=pe(!1);async function o(){if(!(t().claimed_by||m(a))){X(a,!0);try{await r()(t().id)}finally{X(a,!1)}}}async function c(){if(!(!i()||m(a))){X(a,!0);try{await s()(t().id)}finally{X(a,!1)}}}const l=k=>(k??"").trim(),u={Ainara:{card:"border-pink-300 bg-pink-50",badge:"bg-pink-50 text-pink-800 border-pink-200"},Conchi:{card:"border-emerald-300 bg-emerald-50",badge:"bg-emerald-50 text-emerald-800 border-emerald-200"},"Celia del Carmen":{card:"border-sky-300 bg-sky-50",badge:"bg-sky-50 text-sky-800 border-sky-200"}};function h(){const k=l(t().claimed_by);return k?k===l(i())?"border-amber-400 bg-amber-50":u[k]?.card??"border-zinc-300 bg-zinc-50":"border-zinc-200 bg-white"}function d(){const k=l(t().claimed_by);return k===l(i())?"bg-amber-50 text-amber-800 border-amber-200":u[k]?.badge??"bg-zinc-50 text-zinc-700 border-zinc-200"}Ct();var g=So(),f=N(g),p=N(f);{var v=k=>{var R=lo();J(()=>{de(R,"src",(L(t()),C(()=>t().image_url))),de(R,"alt",(L(t()),C(()=>t().title)))}),U(k,R)};Q(p,k=>{L(t()),C(()=>t().image_url)&&k(v)})}var y=M(p,2),_=N(y);{var w=k=>{var R=co(),F=M(N(R)),le=N(F,!0);I(F),I(R),J(ne=>{nt(R,1,ne),ee(le,(L(t()),C(()=>t().claimed_by)))},[()=>C(()=>`text-[11px] px-2 py-1 rounded-full border ${d()}`)]),U(k,R)};Q(_,k=>{L(t()),C(()=>t().claimed_by)&&k(w)})}var E=M(_,2);{var A=k=>{var R=yt(),F=Ye(R);{var le=Y=>{var ce=uo();J(()=>ce.disabled=m(a)),je("click",ce,c),U(Y,ce)},ne=Y=>{var ce=ho();U(Y,ce)};Q(F,Y=>{L(i()),L(t()),C(()=>i()&&l(i())===l(t().claimed_by))?Y(le):Y(ne,!1)})}U(k,R)},b=k=>{var R=fo(),F=N(R,!0);I(R),J(()=>{R.disabled=m(a),ee(F,m(a)?"Reservandoâ¦":"Reservar")}),je("click",R,o),U(k,R)};Q(E,k=>{L(t()),C(()=>t().claimed_by)?k(A):k(b,!1)})}I(y),I(f);var S=M(f,2),x=N(S),H=N(x,!0);I(x);var ve=M(x,2);{var O=k=>{var R=go(),F=N(R,!0);I(R),J(()=>ee(F,(L(t()),C(()=>t().notes)))),U(k,R)};Q(ve,k=>{L(t()),C(()=>t().notes)&&k(O)})}var P=M(ve,2),$=N(P);{var G=k=>{var R=po(),F=N(R);I(R),J(()=>ee(F,`~ ${L(t()),C(()=>t().price)??""}â¬`)),U(k,R)};Q($,k=>{L(t()),C(()=>t().price)&&k(G)})}var re=M($,2);{var Z=k=>{var R=vo();J(()=>de(R,"href",(L(t()),C(()=>t().url)))),U(k,R)};Q(re,k=>{L(t()),C(()=>t().url)&&k(Z)})}var te=M(re,2);{var q=k=>{var R=wo();st(R,5,()=>(L(t()),C(()=>t().categories)),Et,(F,le)=>{var ne=_o(),Y=N(ne,!0);I(ne),J(()=>ee(Y,m(le))),U(F,ne)}),I(R),U(k,R)};Q(te,k=>{L(t()),C(()=>t().categories&&t().categories.length)&&k(q)})}I(P),I(S);var oe=M(S,2),$e=N(oe);{var Ue=k=>{var R=mo(),F=M(N(R)),le=N(F,!0);I(F),I(R),J(ne=>{nt(R,1,ne),ee(le,(L(t()),C(()=>t().claimed_by)))},[()=>C(()=>`text-[11px] md:text-xs px-2 py-1 rounded-full border ${d()}`)]),U(k,R)};Q($e,k=>{L(t()),C(()=>t().claimed_by)&&k(Ue)})}var ke=M($e,2);{var _e=k=>{var R=yt(),F=Ye(R);{var le=Y=>{var ce=bo();J(()=>ce.disabled=m(a)),je("click",ce,c),U(Y,ce)},ne=Y=>{var ce=yo();U(Y,ce)};Q(F,Y=>{L(i()),L(t()),C(()=>i()&&l(i())===l(t().claimed_by))?Y(le):Y(ne,!1)})}U(k,R)},ft=k=>{var R=Eo(),F=N(R,!0);I(R),J(()=>{R.disabled=m(a),ee(F,m(a)?"Reservandoâ¦":"Reservar")}),je("click",R,o),U(k,R)};Q(ke,k=>{L(t()),C(()=>t().claimed_by)?k(_e):k(ft,!1)})}I(oe),I(g),J(k=>{nt(g,1,k),ee(H,(L(t()),C(()=>t().title)))},[()=>C(()=>`w-full rounded-3xl border p-4 md:p-5 backdrop-blur
            flex flex-col md:flex-row gap-3 md:gap-4 transition-all
            hover:shadow-lg hover:-translate-y-0.5 ${h()}`)]),Pn(1,g,()=>oo),U(n,g),Pt()}var To=D('<span><span class="font-medium"> </span> <span class="opacity-80"> </span></span>'),Oo=D('<span class="inline-flex items-center gap-2 px-3 py-1 rounded-2xl border text-sm bg-white/80 border-amber-400 ring-1 ring-amber-300"><span class="font-medium"> </span> <span class="opacity-80"> </span></span>'),Ao=D('<div class="flex items-center justify-between flex-wrap gap-2 mt-2"><div class="text-sm font-medium opacity-80">Totales reservados</div> <div class="flex gap-2 flex-wrap"><!> <!></div></div>'),Ro=D(`<button class="px-3 py-1.5 rounded-xl border text-sm transition
             data-[on=true]:bg-zinc-900 data-[on=true]:text-white"> </button>`),Po=D('<p class="animate-pulse text-sm opacity-70 mt-2">Cargandoâ¦</p>'),jo=D('<p class="mt-2">No hay regalos aÃºn.</p>'),Co=D('<div class="flex flex-col gap-4 mt-2"></div>'),xo=D('<!> <div class="mt-4 flex flex-wrap items-center gap-2"><span class="text-sm opacity-80 mr-1">Filtrar por:</span> <!> <button class="ml-1 text-sm underline opacity-80"> </button></div> <!>',1);function Io(n,e){jt(e,!1);const t=pe();let r=Ce(e,"who",8,null);const s=["Reyes","PapaNoel","TecnologÃ­a","Ropa","Libros"];let i=pe(new Set),a=pe([]),o=pe([]),c=pe(!0),l=pe([]);os(async()=>{X(l,"Conchi:/avatar-conchi.png;Ainara:/avatar-hermana.png;Celia del Carmen:/avatar-pareja.png".split(";").map(P=>P.trim()).filter(Boolean).map(P=>{const[$]=P.split(":");return{name:($??"").trim()}})),await u()});async function u(){X(c,!0);try{let O=Wt.from("gifts").select("*").order("created_at",{ascending:!0});if(m(i).size>0){const G=Array.from(m(i));O=O.overlaps("categories",G)}const{data:P,error:$}=await O;if($)throw $;X(a,P??[]),X(o,m(a))}catch(O){console.error("Error cargando regalos:",O?.message??O),X(a,[]),X(o,[])}finally{X(c,!1)}}async function h(O){if(!r()){alert("Elige tu perfil primero");return}const{error:P}=await Wt.from("gifts").update({claimed_by:r()}).eq("id",O).is("claimed_by",null);P&&alert(P.message),await u()}async function d(O){if(!r()){alert("Elige tu perfil primero");return}const{error:P}=await Wt.from("gifts").update({claimed_by:null}).eq("id",O).eq("claimed_by",r());P&&alert(P.message),await u()}function g(O){if(O==null)return 0;if(typeof O=="number"&&isFinite(O))return O;const $=String(O).replace(",",".").match(/(\d+(\.\d+)?)/);return $?parseFloat($[1]):0}const f=O=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR",maximumFractionDigits:0}).format(Math.round(O));function p(O){m(i).has(O)?m(i).delete(O):m(i).add(O),X(i,new Set(m(i))),u()}function v(){X(i,new Set),u()}fn(()=>m(a),()=>{X(t,m(a).reduce((O,P)=>{const $=(P.claimed_by??"").trim();if(!$)return O;const G=g(P.price);return O[$]=(O[$]??0)+(isFinite(G)?G:0),O},{}))}),gn(),Ct();var y=xo(),_=Ye(y);{var w=O=>{var P=Ao(),$=M(N(P),2),G=N($);st(G,1,()=>m(l),Et,(te,q)=>{var oe=yt(),$e=Ye(oe);{var Ue=ke=>{var _e=To();let ft;var k=N(_e),R=N(k,!0);I(k);var F=M(k,2),le=N(F);I(F),I(_e),J((ne,Y)=>{ft=nt(_e,1,"inline-flex items-center gap-2 px-3 py-1 rounded-2xl border text-sm bg-white/80",null,ft,ne),de(_e,"title",(m(q),C(()=>`Total reservado por ${m(q).name}`))),ee(R,(m(q),C(()=>m(q).name))),ee(le,`Â· ${Y??""}`)},[()=>({"border-amber-400":r()&&r().trim()===m(q).name.trim(),"ring-1":r()&&r().trim()===m(q).name.trim(),"ring-amber-300":r()&&r().trim()===m(q).name.trim()}),()=>(m(t),m(q),C(()=>f(m(t)[m(q).name])))]),U(ke,_e)};Q($e,ke=>{m(t),m(q),C(()=>(m(t)[m(q).name]??0)>0)&&ke(Ue)})}U(te,oe)});var re=M(G,2);{var Z=te=>{var q=Oo(),oe=N(q),$e=N(oe,!0);I(oe);var Ue=M(oe,2),ke=N(Ue);I(Ue),I(q),J(_e=>{ee($e,r()),ee(ke,`Â· ${_e??""}`)},[()=>(m(t),L(r()),C(()=>f(m(t)[r()])))]),U(te,q)};Q(re,te=>{L(r()),m(l),m(t),C(()=>r()&&!m(l).some(q=>q.name.trim()===r().trim())&&(m(t)[r()]??0)>0)&&te(Z)})}I($),I(P),U(O,P)};Q(_,O=>{m(l),C(()=>m(l).length>0)&&O(w)})}var E=M(_,2),A=M(N(E),2);st(A,1,()=>s,Et,(O,P)=>{var $=Ro(),G=N($,!0);I($),J((re,Z)=>{de($,"data-on",re),de($,"aria-pressed",Z),de($,"aria-label",`Filtrar por ${m(P)}`),ee(G,m(P))},[()=>(m(i),m(P),C(()=>m(i).has(m(P)))),()=>(m(i),m(P),C(()=>m(i).has(m(P))))]),je("click",$,()=>p(m(P))),U(O,$)});var b=M(A,2),S=N(b,!0);I(b),I(E);var x=M(E,2);{var H=O=>{var P=Po();U(O,P)},ve=O=>{var P=yt(),$=Ye(P);{var G=Z=>{var te=jo();U(Z,te)},re=Z=>{var te=Co();st(te,5,()=>m(o),q=>q.id,(q,oe)=>{ko(q,{get gift(){return m(oe)},onClaim:h,onUnclaim:d,get who(){return r()}})}),I(te),U(Z,te)};Q($,Z=>{m(o),C(()=>m(o).length===0)?Z(G):Z(re,!1)},!0)}U(O,P)};Q(x,O=>{m(c)?O(H):O(ve,!1)})}J(()=>ee(S,(m(i),C(()=>m(i).size>0?"Quitar filtros (Todos)":"Todos")))),je("click",b,v),U(n,y),Pt()}var $o=D('<div class="rounded-2xl bg-white/70 backdrop-blur border p-4 shadow-sm"><!> <div class="mt-3 text-sm opacity-80"> </div> <!></div>');function Mo(n,e){jt(e,!1);let t=pe(null);console.log("VITE_SUPABASE_URL",void 0),console.log("VITE_SUPABASE_ANON_KEY presente?",!1),Ct();var r=$o(),s=N(r);$n(s,{get current(){return m(t)},onPick:c=>X(t,c)});var i=M(s,2),a=N(i,!0);I(i);var o=M(i,2);Io(o,{get who(){return m(t)}}),I(r),J(()=>ee(a,m(t)?`EstÃ¡s como: ${m(t)}`:"Elige tu perfil")),U(n,r),Pt()}export{Mo as default};
